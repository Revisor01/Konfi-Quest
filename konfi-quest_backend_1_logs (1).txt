📊 Using existing database...
✅ Database initialized successfully
🔧 Setting up middleware...
🔗 Mounting API routes...
🚀 Konfi Points API running on port 5000
📁 Uploads directory: /app/uploads
❌ SMTP connection failed: Error: connect ECONNREFUSED 127.0.1.1:465
    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1555:16) {
  errno: -111,
  code: 'ESOCKET',
  syscall: 'connect',
  address: '127.0.1.1',
  port: 465,
  command: 'CONN'
}
📱 Device Token Registration Request:
User ID: 1
User Type: admin
Platform: ios
Device ID: 2E28689F-DBCA-445B-B99F-BCE913357CEC
Token (first 20 chars): eo4kLPkmjk5gtjr6d37B...
✅ push_tokens table exists
🚫 Identical token already exists, skipping save
📱 Device Token Registration Request:
User ID: 1
User Type: admin
Platform: ios
Device ID: 2E28689F-DBCA-445B-B99F-BCE913357CEC
Token (first 20 chars): eo4kLPkmjk5gtjr6d37B...
✅ push_tokens table exists
🚫 Identical token already exists, skipping save
✅ Room 47 marked as read for user 1 (admin)
✅ Room 47 marked as read for user 1 (admin)
📱 Device Token Registration Request:
User ID: 1
User Type: admin
Platform: ios
Device ID: 2E28689F-DBCA-445B-B99F-BCE913357CEC
Token (first 20 chars): eo4kLPkmjk5gtjr6d37B...
✅ push_tokens table exists
🚫 Identical token already exists, skipping save
✅ Room 47 marked as read for user 2 (admin)
✅ Room 47 marked as read for user 2 (admin)
📱 Badge count for user 1: 1 (including new message)
📨 Sending chat notification to user: 1
🔥 Using Firebase Service Account from file
🔥 Firebase Admin SDK initialized
🔔 Sending Firebase notification...
Device Token: eo4kLPkmjk5gtjr6d37B...
Notification Data: {
  title: 'Pastorin Ulrike Verwold',
  body: 'zhhj',
  badge: 1,
  sound: 'default',
  data: {
    type: 'chat',
    roomId: '47',
    messageId: '553',
    sender_id: '2',
    sender_name: 'Pastorin Ulrike Verwold',
    room_name: 'Pastor Simon Luthe'
  }
}
✅ Room 47 marked as read for user 2 (admin)
❌ Firebase notification error: FirebaseMessagingError: Auth error from APNS or Web Push Service
    at FirebaseMessagingError.fromServerError (/app/node_modules/firebase-admin/lib/utils/error.js:269:16)
    at createFirebaseError (/app/node_modules/firebase-admin/lib/messaging/messaging-errors-internal.js:35:47)
    at /app/node_modules/firebase-admin/lib/messaging/messaging-api-request-internal.js:82:75
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async sendFirebasePushNotification (/app/push/firebase.js:72:22)
    at async Statement.<anonymous> (/app/services/pushService.js:30:15) {
  errorInfo: {
    code: 'messaging/third-party-auth-error',
    message: 'Auth error from APNS or Web Push Service'
  },
  codePrefix: 'messaging'
}
🔥 Firebase already initialized
🔔 Sending Firebase notification...
Device Token: eo4kLPkmjk5gtjr6d37B...
Notification Data: {
  title: 'Pastorin Ulrike Verwold',
  body: 'zhhj',
  badge: 1,
  sound: 'default',
  data: {
    type: 'chat',
    roomId: '47',
    messageId: '553',
    sender_id: '2',
    sender_name: 'Pastorin Ulrike Verwold',
    room_name: 'Pastor Simon Luthe'
  }
}
🔥 Firebase already initialized
🔔 Sending Firebase notification...
❌ Firebase notification error: FirebaseMessagingError: Auth error from APNS or Web Push Service
    at FirebaseMessagingError.fromServerError (/app/node_modules/firebase-admin/lib/utils/error.js:269:16)
    at createFirebaseError (/app/node_modules/firebase-admin/lib/messaging/messaging-errors-internal.js:35:47)
    at /app/node_modules/firebase-admin/lib/messaging/messaging-api-request-internal.js:82:75
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async sendFirebasePushNotification (/app/push/firebase.js:72:22)
    at async Statement.<anonymous> (/app/services/pushService.js:30:15) {
  errorInfo: {
    code: 'messaging/third-party-auth-error',
    message: 'Auth error from APNS or Web Push Service'
  },
  codePrefix: 'messaging'
}
Device Token: eo4kLPkmjk5gtjr6d37B...
Notification Data: {
  title: 'Pastorin Ulrike Verwold',
  body: 'zhhj',
  badge: 1,
  sound: 'default',
  data: {
    type: 'chat',
    roomId: '47',
    messageId: '553',
    sender_id: '2',
    sender_name: 'Pastorin Ulrike Verwold',
    room_name: 'Pastor Simon Luthe'
  }
}
📱 Device Token Registration Request:
User ID: 1
User Type: admin
Platform: ios
Device ID: 2E28689F-DBCA-445B-B99F-BCE913357CEC
Token (first 20 chars): eo4kLPkmjk5gtjr6d37B...
✅ push_tokens table exists
🚫 Identical token already exists, skipping save
❌ Firebase notification error: FirebaseMessagingError: Auth error from APNS or Web Push Service
    at FirebaseMessagingError.fromServerError (/app/node_modules/firebase-admin/lib/utils/error.js:269:16)
    at createFirebaseError (/app/node_modules/firebase-admin/lib/messaging/messaging-errors-internal.js:35:47)
    at /app/node_modules/firebase-admin/lib/messaging/messaging-api-request-internal.js:82:75
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async sendFirebasePushNotification (/app/push/firebase.js:72:22)
    at async Statement.<anonymous> (/app/services/pushService.js:30:15) {
✅ Chat notification sent: 3 success, 0 errors
  errorInfo: {
    code: 'messaging/third-party-auth-error',
    message: 'Auth error from APNS or Web Push Service'
  },
  codePrefix: 'messaging'
}
✅ Room 47 marked as read for user 1 (admin)
✅ Room 47 marked as read for user 1 (admin)
📱 Badge count for user 2: 71 (including new message)
📨 Sending chat notification to user: 2
⚠️ No push tokens found for user: 2
✅ Room 47 marked as read for user 1 (admin)
✅ Room 47 marked as read for user 2 (admin)
✅ Room 47 marked as read for user 2 (admin)
📱 Badge count for user 1: 1 (including new message)
📨 Sending chat notification to user: 1
🔥 Firebase already initialized
🔔 Sending Firebase notification...
Device Token: eo4kLPkmjk5gtjr6d37B...
Notification Data: {
  title: 'Pastorin Ulrike Verwold',
  body: 'khgh',
  badge: 1,
  sound: 'default',
  data: {
    type: 'chat',
    roomId: '47',
    messageId: '555',
    sender_id: '2',
    sender_name: 'Pastorin Ulrike Verwold',
    room_name: 'Pastor Simon Luthe'
  }
}
✅ Room 47 marked as read for user 2 (admin)
🔥 Firebase already initialized
🔔 Sending Firebase notification...
Device Token: eo4kLPkmjk5gtjr6d37B...
Notification Data: {
  title: 'Pastorin Ulrike Verwold',
  body: 'khgh',
  badge: 1,
  sound: 'default',
  data: {
    type: 'chat',
    roomId: '47',
    messageId: '555',
    sender_id: '2',
    sender_name: 'Pastorin Ulrike Verwold',
    room_name: 'Pastor Simon Luthe'
  }
}
❌ Firebase notification error: FirebaseMessagingError: Auth error from APNS or Web Push Service
    at FirebaseMessagingError.fromServerError (/app/node_modules/firebase-admin/lib/utils/error.js:269:16)
    at createFirebaseError (/app/node_modules/firebase-admin/lib/messaging/messaging-errors-internal.js:35:47)
    at /app/node_modules/firebase-admin/lib/messaging/messaging-api-request-internal.js:82:75
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async sendFirebasePushNotification (/app/push/firebase.js:72:22)
    at async Statement.<anonymous> (/app/services/pushService.js:30:15) {
  errorInfo: {
    code: 'messaging/third-party-auth-error',
    message: 'Auth error from APNS or Web Push Service'
  },
  codePrefix: 'messaging'
}
❌ Firebase notification error: FirebaseMessagingError: Auth error from APNS or Web Push Service
    at FirebaseMessagingError.fromServerError (/app/node_modules/firebase-admin/lib/utils/error.js:269:16)
    at createFirebaseError (/app/node_modules/firebase-admin/lib/messaging/messaging-errors-internal.js:35:47)
    at /app/node_modules/firebase-admin/lib/messaging/messaging-api-request-internal.js:82:75
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async sendFirebasePushNotification (/app/push/firebase.js:72:22)
    at async Statement.<anonymous> (/app/services/pushService.js:30:15) {
  errorInfo: {
    code: 'messaging/third-party-auth-error',
    message: 'Auth error from APNS or Web Push Service'
  },
  codePrefix: 'messaging'
}
🔥 Firebase already initialized
🔔 Sending Firebase notification...
Device Token: eo4kLPkmjk5gtjr6d37B...
Notification Data: {
  title: 'Pastorin Ulrike Verwold',
  body: 'khgh',
  badge: 1,
  sound: 'default',
  data: {
    type: 'chat',
    roomId: '47',
    messageId: '555',
    sender_id: '2',
    sender_name: 'Pastorin Ulrike Verwold',
    room_name: 'Pastor Simon Luthe'
  }
}
❌ Firebase notification error: FirebaseMessagingError: Auth error from APNS or Web Push Service
    at FirebaseMessagingError.fromServerError (/app/node_modules/firebase-admin/lib/utils/error.js:269:16)
    at createFirebaseError (/app/node_modules/firebase-admin/lib/messaging/messaging-errors-internal.js:35:47)
    at /app/node_modules/firebase-admin/lib/messaging/messaging-api-request-internal.js:82:75
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async sendFirebasePushNotification (/app/push/firebase.js:72:22)
    at async Statement.<anonymous> (/app/services/pushService.js:30:15) {
  errorInfo: {
    code: 'messaging/third-party-auth-error',
    message: 'Auth error from APNS or Web Push Service'
  },
  codePrefix: 'messaging'
}
✅ Chat notification sent: 3 success, 0 errors
📱 Device Token Registration Request:
User ID: 1
User Type: admin
Platform: ios
Device ID: 2E28689F-DBCA-445B-B99F-BCE913357CEC
Token (first 20 chars): eo4kLPkmjk5gtjr6d37B...
✅ push_tokens table exists
🚫 Identical token already exists, skipping save
📱 Badge count for user 1: 2 (including new message)
📨 Sending chat notification to user: 1
🔥 Firebase already initialized
🔔 Sending Firebase notification...
Device Token: eo4kLPkmjk5gtjr6d37B...
Notification Data: {
  title: 'Pastorin Ulrike Verwold',
  body: 'fgg',
  badge: 2,
  sound: 'default',
  data: {
    type: 'chat',
    roomId: '47',
    messageId: '556',
    sender_id: '2',
    sender_name: 'Pastorin Ulrike Verwold',
    room_name: 'Pastor Simon Luthe'
  }
}
✅ Room 47 marked as read for user 2 (admin)
❌ Firebase notification error: FirebaseMessagingError: Auth error from APNS or Web Push Service
    at FirebaseMessagingError.fromServerError (/app/node_modules/firebase-admin/lib/utils/error.js:269:16)
    at createFirebaseError (/app/node_modules/firebase-admin/lib/messaging/messaging-errors-internal.js:35:47)
    at /app/node_modules/firebase-admin/lib/messaging/messaging-api-request-internal.js:82:75
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async sendFirebasePushNotification (/app/push/firebase.js:72:22)
    at async Statement.<anonymous> (/app/services/pushService.js:30:15) {
  errorInfo: {
    code: 'messaging/third-party-auth-error',
    message: 'Auth error from APNS or Web Push Service'
  },
  codePrefix: 'messaging'
}
🔥 Firebase already initialized
🔔 Sending Firebase notification...
Device Token: eo4kLPkmjk5gtjr6d37B...
Notification Data: {
  title: 'Pastorin Ulrike Verwold',
  body: 'fgg',
  badge: 2,
  sound: 'default',
  data: {
    type: 'chat',
    roomId: '47',
    messageId: '556',
    sender_id: '2',
    sender_name: 'Pastorin Ulrike Verwold',
    room_name: 'Pastor Simon Luthe'
  }
}
❌ Firebase notification error: FirebaseMessagingError: Auth error from APNS or Web Push Service
    at FirebaseMessagingError.fromServerError (/app/node_modules/firebase-admin/lib/utils/error.js:269:16)
    at createFirebaseError (/app/node_modules/firebase-admin/lib/messaging/messaging-errors-internal.js:35:47)
    at /app/node_modules/firebase-admin/lib/messaging/messaging-api-request-internal.js:82:75
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async sendFirebasePushNotification (/app/push/firebase.js:72:22)
    at async Statement.<anonymous> (/app/services/pushService.js:30:15) {
  errorInfo: {
    code: 'messaging/third-party-auth-error',
    message: 'Auth error from APNS or Web Push Service'
  },
  codePrefix: 'messaging'
}
🔥 Firebase already initialized
🔔 Sending Firebase notification...
Device Token: eo4kLPkmjk5gtjr6d37B...
Notification Data: {
  title: 'Pastorin Ulrike Verwold',
  body: 'fgg',
  badge: 2,
  sound: 'default',
  data: {
    type: 'chat',
    roomId: '47',
    messageId: '556',
    sender_id: '2',
    sender_name: 'Pastorin Ulrike Verwold',
    room_name: 'Pastor Simon Luthe'
  }
}
✅ Chat notification sent: 3 success, 0 errors
❌ Firebase notification error: FirebaseMessagingError: Auth error from APNS or Web Push Service
    at FirebaseMessagingError.fromServerError (/app/node_modules/firebase-admin/lib/utils/error.js:269:16)
    at createFirebaseError (/app/node_modules/firebase-admin/lib/messaging/messaging-errors-internal.js:35:47)
    at /app/node_modules/firebase-admin/lib/messaging/messaging-api-request-internal.js:82:75
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async sendFirebasePushNotification (/app/push/firebase.js:72:22)
    at async Statement.<anonymous> (/app/services/pushService.js:30:15) {
  errorInfo: {
    code: 'messaging/third-party-auth-error',
    message: 'Auth error from APNS or Web Push Service'
  },
  codePrefix: 'messaging'
}
📱 Device Token Registration Request:
User ID: 1
User Type: admin
Platform: ios
Device ID: 2E28689F-DBCA-445B-B99F-BCE913357CEC
Token (first 20 chars): eo4kLPkmjk5gtjr6d37B...
✅ push_tokens table exists
🚫 Identical token already exists, skipping save
✅ Room 47 marked as read for user 1 (admin)
✅ Room 47 marked as read for user 1 (admin)
📱 Badge count for user 2: 71 (including new message)
📨 Sending chat notification to user: 2
⚠️ No push tokens found for user: 2
✅ Room 47 marked as read for user 1 (admin)
📱 Device Token Registration Request:
User ID: 1
User Type: admin
Platform: ios
Device ID: 2E28689F-DBCA-445B-B99F-BCE913357CEC
Token (first 20 chars): eo4kLPkmjk5gtjr6d37B...
✅ push_tokens table exists
🚫 Identical token already exists, skipping save
📱 Device Token Registration Request:
User ID: 1
User Type: admin
Platform: ios
Device ID: 2F3A9F72-AC5E-4C00-A30F-7C0D6ADA93C1
Token (first 20 chars): eo4kLPkmjk5gtjr6d37B...
✅ push_tokens table exists
🚫 Identical token already exists, skipping save
✅ Room 47 marked as read for user 2 (admin)
✅ Room 47 marked as read for user 2 (admin)
📱 Badge count for user 1: 1 (including new message)
📨 Sending chat notification to user: 1
🔥 Firebase already initialized
🔔 Sending Firebase notification...
Device Token: eo4kLPkmjk5gtjr6d37B...
Notification Data: {
  title: 'Pastorin Ulrike Verwold',
  body: 'nnbn',
  badge: 1,
  sound: 'default',
  data: {
    type: 'chat',
    roomId: '47',
    messageId: '558',
    sender_id: '2',
    sender_name: 'Pastorin Ulrike Verwold',
    room_name: 'Pastor Simon Luthe'
  }
}
✅ Room 47 marked as read for user 2 (admin)
✅ Firebase notification sent successfully: projects/konfiquest-push/messages/1753514193725724
🔥 Firebase already initialized
🔔 Sending Firebase notification...
Device Token: eo4kLPkmjk5gtjr6d37B...
Notification Data: {
  title: 'Pastorin Ulrike Verwold',
  body: 'nnbn',
  badge: 1,
  sound: 'default',
  data: {
    type: 'chat',
    roomId: '47',
    messageId: '558',
    sender_id: '2',
    sender_name: 'Pastorin Ulrike Verwold',
    room_name: 'Pastor Simon Luthe'
  }
}
✅ Firebase notification sent successfully: projects/konfiquest-push/messages/1753514194133188
🔥 Firebase already initialized
🔔 Sending Firebase notification...
Device Token: eo4kLPkmjk5gtjr6d37B...
Notification Data: {
  title: 'Pastorin Ulrike Verwold',
  body: 'nnbn',
  badge: 1,
  sound: 'default',
  data: {
    type: 'chat',
    roomId: '47',
    messageId: '558',
    sender_id: '2',
    sender_name: 'Pastorin Ulrike Verwold',
    room_name: 'Pastor Simon Luthe'
  }
}
✅ Firebase notification sent successfully: projects/konfiquest-push/messages/1753514194466880
✅ Chat notification sent: 3 success, 0 errors
🔐 RBAC login attempt for: swantje
✅ admin login successful: swantje (Pastorin Swantje Luthe)
Loading permissions for user 30 (role_id: 1), found 72 permissions
📱 Device Token Registration Request:
User ID: 30
User Type: admin
Platform: ios
Device ID: 1883C710-F28F-4FA2-BF45-CE3131EE4034
Token (first 20 chars): fxS32KwMQ0Fcn3BZqJbK...
✅ push_tokens table exists
✅ Push token saved successfully. Row ID: 51
✅ Token verified in database: {
  id: 51,
  user_id: 30,
  platform: 'ios',
  device_id: '1883C710-F28F-4FA2-BF45-CE3131EE4034',
  token_preview: 'fxS32KwMQ0Fcn3BZqJbK...',
  updated_at: '2025-07-26 07:18:38'
}
✅ Room 48 marked as read for user 30 (admin)
✅ Room 48 marked as read for user 30 (admin)
✅ Room 48 marked as read for user 30 (admin)
✅ Room 48 marked as read for user 30 (admin)
📱 Badge count for user 1: 2 (including new message)
📨 Sending chat notification to user: 1
🔥 Firebase already initialized
🔔 Sending Firebase notification...
Device Token: eo4kLPkmjk5gtjr6d37B...
Notification Data: {
  title: 'Pastorin Swantje Luthe',
  body: 'fbfb',
  badge: 2,
  sound: 'default',
  data: {
    type: 'chat',
    roomId: '48',
    messageId: '559',
    sender_id: '30',
    sender_name: 'Pastorin Swantje Luthe',
    room_name: 'Pastorin Swantje Luthe'
  }
}
✅ Room 48 marked as read for user 30 (admin)
✅ Room 48 marked as read for user 30 (admin)
✅ Firebase notification sent successfully: projects/konfiquest-push/messages/1753514322240683
🔥 Firebase already initialized
🔔 Sending Firebase notification...
Device Token: eo4kLPkmjk5gtjr6d37B...
Notification Data: {
  title: 'Pastorin Swantje Luthe',
  body: 'fbfb',
  badge: 2,
  sound: 'default',
  data: {
    type: 'chat',
    roomId: '48',
    messageId: '559',
    sender_id: '30',
    sender_name: 'Pastorin Swantje Luthe',
    room_name: 'Pastorin Swantje Luthe'
  }
}
✅ Firebase notification sent successfully: projects/konfiquest-push/messages/1753514322562167
🔥 Firebase already initialized
🔔 Sending Firebase notification...
Device Token: eo4kLPkmjk5gtjr6d37B...
Notification Data: {
  title: 'Pastorin Swantje Luthe',
  body: 'fbfb',
  badge: 2,
  sound: 'default',
  data: {
    type: 'chat',
    roomId: '48',
    messageId: '559',
    sender_id: '30',
    sender_name: 'Pastorin Swantje Luthe',
    room_name: 'Pastorin Swantje Luthe'
  }
}
✅ Firebase notification sent successfully: projects/konfiquest-push/messages/1753514322752682
✅ Chat notification sent: 3 success, 0 errors
✅ Room 48 marked as read for user 30 (admin)
✅ Room 48 marked as read for user 30 (admin)
✅ Room 48 marked as read for user 30 (admin)
✅ Room 48 marked as read for user 30 (admin)
📱 Badge count for user 1: 3 (including new message)
📨 Sending chat notification to user: 1
🔥 Firebase already initialized
🔔 Sending Firebase notification...
Device Token: eo4kLPkmjk5gtjr6d37B...
Notification Data: {
  title: 'Pastorin Swantje Luthe',
  body: 'cnfnx',
  badge: 3,
  sound: 'default',
  data: {
    type: 'chat',
    roomId: '48',
    messageId: '560',
    sender_id: '30',
    sender_name: 'Pastorin Swantje Luthe',
    room_name: 'Pastorin Swantje Luthe'
  }
}
✅ Room 48 marked as read for user 30 (admin)
✅ Room 48 marked as read for user 30 (admin)
✅ Firebase notification sent successfully: projects/konfiquest-push/messages/1753514328293149
🔥 Firebase already initialized
🔔 Sending Firebase notification...
Device Token: eo4kLPkmjk5gtjr6d37B...
Notification Data: {
  title: 'Pastorin Swantje Luthe',
  body: 'cnfnx',
  badge: 3,
  sound: 'default',
  data: {
    type: 'chat',
    roomId: '48',
    messageId: '560',
    sender_id: '30',
    sender_name: 'Pastorin Swantje Luthe',
    room_name: 'Pastorin Swantje Luthe'
  }
}
✅ Firebase notification sent successfully: projects/konfiquest-push/messages/1753514328564119
🔥 Firebase already initialized
🔔 Sending Firebase notification...
Device Token: eo4kLPkmjk5gtjr6d37B...
Notification Data: {
  title: 'Pastorin Swantje Luthe',
  body: 'cnfnx',
  badge: 3,
  sound: 'default',
  data: {
    type: 'chat',
    roomId: '48',
    messageId: '560',
    sender_id: '30',
    sender_name: 'Pastorin Swantje Luthe',
    room_name: 'Pastorin Swantje Luthe'
  }
}
✅ Firebase notification sent successfully: projects/konfiquest-push/messages/1753514328932885
✅ Chat notification sent: 3 success, 0 errors
✅ Room 38 marked as read for user 30 (admin)
✅ Room 38 marked as read for user 30 (admin)
✅ Room 38 marked as read for user 30 (admin)
✅ Room 38 marked as read for user 30 (admin)
✅ Room 2 marked as read for user 30 (admin)
✅ Room 2 marked as read for user 30 (admin)
✅ Room 2 marked as read for user 30 (admin)
✅ Room 2 marked as read for user 30 (admin)
📱 Device Token Registration Request:
User ID: 30
User Type: admin
Platform: ios
Device ID: 1883C710-F28F-4FA2-BF45-CE3131EE4034
Token (first 20 chars): fxS32KwMQ0Fcn3BZqJbK...
✅ push_tokens table exists
🚫 Identical token already exists, skipping save
📱 Device Token Registration Request:
User ID: 1
User Type: admin
Platform: ios
Device ID: 2F3A9F72-AC5E-4C00-A30F-7C0D6ADA93C1
Token (first 20 chars): eo4kLPkmjk5gtjr6d37B...
✅ push_tokens table exists
🚫 Identical token already exists, skipping save
✅ Room 48 marked as read for user 1 (admin)
✅ Room 48 marked as read for user 1 (admin)
📱 Badge count for user 30: 1 (including new message)
📨 Sending chat notification to user: 30
🔥 Firebase already initialized
🔔 Sending Firebase notification...
Device Token: fxS32KwMQ0Fcn3BZqJbK...
Notification Data: {
  title: 'Neue Nachricht',
  body: 'hi',
  badge: 1,
  sound: 'default',
  data: {
    type: 'chat',
    roomId: '48',
    messageId: '561',
    sender_id: '1',
    sender_name: '',
    room_name: 'Pastorin Swantje Luthe'
  }
}
✅ Room 48 marked as read for user 1 (admin)
✅ Room 48 marked as read for user 1 (admin)
✅ Firebase notification sent successfully: projects/konfiquest-push/messages/1753514408214679
✅ Chat notification sent: 1 success, 0 errors
✅ Room 48 marked as read for user 30 (admin)
✅ Room 48 marked as read for user 30 (admin)
📱 Device Token Registration Request:
User ID: 30
User Type: admin
Platform: ios
Device ID: 1883C710-F28F-4FA2-BF45-CE3131EE4034
Token (first 20 chars): fxS32KwMQ0Fcn3BZqJbK...
✅ push_tokens table exists
🚫 Identical token already exists, skipping save
📱 Badge count for user 1: 2 (including new message)
📨 Sending chat notification to user: 1
🔥 Firebase already initialized
🔔 Sending Firebase notification...
Device Token: eo4kLPkmjk5gtjr6d37B...
Notification Data: {
  title: 'Pastorin Swantje Luthe',
  body: 'hi',
  badge: 2,
  sound: 'default',
  data: {
    type: 'chat',
    roomId: '48',
    messageId: '562',
    sender_id: '30',
    sender_name: 'Pastorin Swantje Luthe',
    room_name: 'Pastorin Swantje Luthe'
  }
}
✅ Room 48 marked as read for user 30 (admin)
✅ Room 48 marked as read for user 30 (admin)
✅ Firebase notification sent successfully: projects/konfiquest-push/messages/1753514418249724
🔥 Firebase already initialized
🔔 Sending Firebase notification...
Device Token: eo4kLPkmjk5gtjr6d37B...
Notification Data: {
  title: 'Pastorin Swantje Luthe',
  body: 'hi',
  badge: 2,
  sound: 'default',
  data: {
    type: 'chat',
    roomId: '48',
    messageId: '562',
    sender_id: '30',
    sender_name: 'Pastorin Swantje Luthe',
    room_name: 'Pastorin Swantje Luthe'
  }
}
✅ Firebase notification sent successfully: projects/konfiquest-push/messages/1753514418523234
🔥 Firebase already initialized
🔔 Sending Firebase notification...
Device Token: eo4kLPkmjk5gtjr6d37B...
Notification Data: {
  title: 'Pastorin Swantje Luthe',
  body: 'hi',
  badge: 2,
  sound: 'default',
  data: {
    type: 'chat',
    roomId: '48',
    messageId: '562',
    sender_id: '30',
    sender_name: 'Pastorin Swantje Luthe',
    room_name: 'Pastorin Swantje Luthe'
  }
}
✅ Firebase notification sent successfully: projects/konfiquest-push/messages/1753514418895323
✅ Chat notification sent: 3 success, 0 errors
✅ Room 48 marked as read for user 1 (admin)
📱 Badge count for user 1: 2 (including new message)
📨 Sending chat notification to user: 1
🔥 Firebase already initialized
🔔 Sending Firebase notification...
Device Token: eo4kLPkmjk5gtjr6d37B...
Notification Data: {
  title: 'Pastorin Swantje Luthe',
  body: 'wie gehts',
  badge: 2,
  sound: 'default',
  data: {
    type: 'chat',
    roomId: '48',
    messageId: '563',
    sender_id: '30',
    sender_name: 'Pastorin Swantje Luthe',
    room_name: 'Pastorin Swantje Luthe'
  }
}
✅ Room 48 marked as read for user 30 (admin)
✅ Room 48 marked as read for user 30 (admin)
✅ Firebase notification sent successfully: projects/konfiquest-push/messages/1753514427802843
🔥 Firebase already initialized
🔔 Sending Firebase notification...
Device Token: eo4kLPkmjk5gtjr6d37B...
Notification Data: {
  title: 'Pastorin Swantje Luthe',
  body: 'wie gehts',
  badge: 2,
  sound: 'default',
  data: {
    type: 'chat',
    roomId: '48',
    messageId: '563',
    sender_id: '30',
    sender_name: 'Pastorin Swantje Luthe',
    room_name: 'Pastorin Swantje Luthe'
  }
}
✅ Firebase notification sent successfully: projects/konfiquest-push/messages/1753514428095120
🔥 Firebase already initialized
🔔 Sending Firebase notification...
Device Token: eo4kLPkmjk5gtjr6d37B...
Notification Data: {
  title: 'Pastorin Swantje Luthe',
  body: 'wie gehts',
  badge: 2,
  sound: 'default',
  data: {
    type: 'chat',
    roomId: '48',
    messageId: '563',
    sender_id: '30',
    sender_name: 'Pastorin Swantje Luthe',
    room_name: 'Pastorin Swantje Luthe'
  }
}
✅ Firebase notification sent successfully: projects/konfiquest-push/messages/1753514428347714
✅ Chat notification sent: 3 success, 0 errors
📱 Device Token Registration Request:
User ID: 1
User Type: admin
Platform: ios
Device ID: 2F3A9F72-AC5E-4C00-A30F-7C0D6ADA93C1
Token (first 20 chars): eo4kLPkmjk5gtjr6d37B...
✅ push_tokens table exists
🚫 Identical token already exists, skipping save
✅ Room 47 marked as read for user 1 (admin)
✅ Room 47 marked as read for user 1 (admin)
